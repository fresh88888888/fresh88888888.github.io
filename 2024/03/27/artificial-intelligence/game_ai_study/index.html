<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">
  <meta name="google-site-verification" content="lk2gSYFP_NyLNFob-fFnt7fm-I_n1ZYws-WZll7mshg">
  <meta name="msvalidate.01" content="6Jdc01DjYOLguhS5">
  <meta name="baidu-site-verification" content="code-NR10G09zww">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic%7Ccursive:300,300italic,400,400italic,700,700italic%7CSource+Code+Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/yellow/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"fresh88888888.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/local-search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":10,"unescape":false,"preload":true}}</script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/config.min.js"></script>

    <meta name="description" content="游戏AI环境设置游戏环境配备了已经为您实现的代理。要查看这些默认代理的列表，请运行： 123456789from kaggle_environments import make, evaluate# Create the game environment# Set debug&#x3D;True to see the errors if your agent refuses to runenv &#x3D; make">
<meta property="og:type" content="article">
<meta property="og:title" content="游戏AI &amp; 强化学习">
<meta property="og:url" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/index.html">
<meta property="og:site_name" content="UMBRELLA">
<meta property="og:description" content="游戏AI环境设置游戏环境配备了已经为您实现的代理。要查看这些默认代理的列表，请运行： 123456789from kaggle_environments import make, evaluate# Create the game environment# Set debug&#x3D;True to see the errors if your agent refuses to runenv &#x3D; make">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/ga_1.png">
<meta property="og:image" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/ga_2.png">
<meta property="og:image" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/ga_3.png">
<meta property="og:image" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/ga_4.png">
<meta property="og:image" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/ga_5.png">
<meta property="og:image" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/ga_6.png">
<meta property="og:image" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/ga_7.png">
<meta property="og:image" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/ga_8.png">
<meta property="og:image" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/ga_9.png">
<meta property="og:image" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/ga_10.png">
<meta property="article:published_time" content="2024-03-27T01:10:32.000Z">
<meta property="article:modified_time" content="2024-03-27T01:10:32.000Z">
<meta property="article:author" content="umbrella">
<meta property="article:tag" content="AI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/ga_1.png">


<link rel="canonical" href="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/","path":"2024/03/27/artificial-intelligence/game_ai_study/","title":"游戏AI & 强化学习"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>游戏AI & 强化学习 | UMBRELLA</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">UMBRELLA</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">未雨绸缪，举重若轻</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-算法"><a href="/Algorithm/" rel="section"><i class="fa fa-calendar fa-fw"></i>算法</a></li><li class="menu-item menu-item-c++-&nbsp;编程"><a href="/Programming-C++/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>C++ &nbsp;编程</a></li><li class="menu-item menu-item-rust-编程"><a href="/Programming-Rust/" rel="section"><i class="fa fa-cat fa-fw"></i>Rust 编程</a></li><li class="menu-item menu-item-go-&nbsp;&nbsp;&nbsp;编程"><a href="/Programming-Go/" rel="section"><i class="fa fa-hippo fa-fw"></i>Go &nbsp;&nbsp;&nbsp;编程</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B8%B8%E6%88%8FAI"><span class="nav-number">1.</span> <span class="nav-text">游戏AI</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E8%AE%BE%E7%BD%AE"><span class="nav-number">1.1.</span> <span class="nav-text">环境设置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E4%BB%A3%E7%90%86"><span class="nav-number">1.2.</span> <span class="nav-text">定义代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%84%E4%BC%B0%E4%BB%A3%E7%90%86"><span class="nav-number">1.3.</span> <span class="nav-text">评估代理</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#One-Step-Lookahead"><span class="nav-number">2.</span> <span class="nav-text">One-Step Lookahead</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E6%A0%91%EF%BC%88Game-trees%EF%BC%89"><span class="nav-number">2.1.</span> <span class="nav-text">游戏树（Game trees）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%AF%E5%8F%91%E5%BC%8F%EF%BC%88Heuristics%EF%BC%89"><span class="nav-number">2.2.</span> <span class="nav-text">启发式（Heuristics）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Code"><span class="nav-number">2.3.</span> <span class="nav-text">Code</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#N-Step-Lookahead"><span class="nav-number">3.</span> <span class="nav-text">N-Step Lookahead</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">3.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Minimax%E7%AE%97%E6%B3%95"><span class="nav-number">3.2.</span> <span class="nav-text">Minimax算法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Code-1"><span class="nav-number">3.3.</span> <span class="nav-text">Code</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%B1%E5%BA%A6%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%EF%BC%88Deep-Reinforcement-Learning%EF%BC%89"><span class="nav-number">4.</span> <span class="nav-text">深度强化学习（Deep Reinforcement Learning）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="nav-number">4.1.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C"><span class="nav-number">4.2.</span> <span class="nav-text">神经网络</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE"><span class="nav-number">4.3.</span> <span class="nav-text">设置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%EF%BC%88Reinforcement-Learning%EF%BC%89"><span class="nav-number">4.4.</span> <span class="nav-text">强化学习（Reinforcement Learning）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Code-2"><span class="nav-number">4.5.</span> <span class="nav-text">Code</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="umbrella"
      src="/avatar.jpeg">
  <p class="site-author-name" itemprop="name">umbrella</p>
  <div class="site-description" itemprop="description">没事就多看看书</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">241</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/fresh88888888" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;fresh88888888" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:fresh888888@foxmail.com" title="E-Mail → mailto:fresh888888@foxmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://www.rust-lang.org/zh-CN/" title="https:&#x2F;&#x2F;www.rust-lang.org&#x2F;zh-CN&#x2F;" rel="noopener" target="_blank">Rust</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://go.dev/" title="https:&#x2F;&#x2F;go.dev&#x2F;" rel="noopener" target="_blank">Golang</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://isocpp.org/" title="https:&#x2F;&#x2F;isocpp.org&#x2F;" rel="noopener" target="_blank">C++</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://www.python.org/" title="https:&#x2F;&#x2F;www.python.org&#x2F;" rel="noopener" target="_blank">Python</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://doc.rust-lang.org/cargo/index.html" title="https:&#x2F;&#x2F;doc.rust-lang.org&#x2F;cargo&#x2F;index.html" rel="noopener" target="_blank">Cargo</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="https://gist.github.com/rxaviers/7360908" title="https:&#x2F;&#x2F;gist.github.com&#x2F;rxaviers&#x2F;7360908" rel="noopener" target="_blank">Emoji</a>
            </li>
        </ul>
      </div>
    </div>
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.jpeg">
      <meta itemprop="name" content="umbrella">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="UMBRELLA">
      <meta itemprop="description" content="没事就多看看书">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="游戏AI & 强化学习 | UMBRELLA">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          游戏AI & 强化学习
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-03-27 09:10:32" itemprop="dateCreated datePublished" datetime="2024-03-27T09:10:32+08:00">2024-03-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" itemprop="url" rel="index"><span itemprop="name">人工智能</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>24 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h4 id="游戏AI"><a href="#游戏AI" class="headerlink" title="游戏AI"></a>游戏AI</h4><h5 id="环境设置"><a href="#环境设置" class="headerlink" title="环境设置"></a>环境设置</h5><p>游戏环境配备了已经为您实现的代理。要查看这些默认代理的列表，请运行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> kaggle_environments <span class="keyword">import</span> make, evaluate</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the game environment</span></span><br><span class="line"><span class="comment"># Set debug=True to see the errors if your agent refuses to run</span></span><br><span class="line">env = make(<span class="string">&quot;connectx&quot;</span>, debug=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># List of available default agents</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(env.agents))</span><br><span class="line"><span class="comment"># [&#x27;random&#x27;, &#x27;negamax&#x27;]</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>
<p>“<code>random</code>”代理从有效移动集中（统一）随机选择。在四子棋中，如果该列中仍有空间放置棋子（即，如果棋盘有七行，则该列中的棋子少于七个），则移动被视为有效。在下面的代码单元中，该代理与自身的副本玩一轮游戏。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Two random agents play one game round</span></span><br><span class="line">env.run([<span class="string">&quot;random&quot;</span>, <span class="string">&quot;random&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show the game</span></span><br><span class="line">env.render(mode=<span class="string">&quot;ipython&quot;</span>)</span><br></pre></td></tr></table></figure>
<h5 id="定义代理"><a href="#定义代理" class="headerlink" title="定义代理"></a>定义代理</h5><p>您将创建自己的代理。您的代理应实现为接受两个参数的<code>Python</code>函数：<code>obs</code>和<code>config</code>。它返回一个包含所选列的整数，其中索引从零开始。因此，返回值是<code>0-6</code>之一（含）。我们将从几个示例开始，以提供一些背景信息。在下面的代码单元中：</p>
<ul>
<li>第一个代理的行为与上面的“随机”代理相同。</li>
<li>第二个代理总是选择中间的列，无论它是否有效！请注意，如果任何智能体选择了无效的移动，它就会输掉比赛。</li>
<li>第三个代理选择最左边的有效列。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># Selects random valid column</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">agent_random</span>(<span class="params">obs, config</span>):</span><br><span class="line">    valid_moves = [col <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns) <span class="keyword">if</span> obs.board[col] == <span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> random.choice(valid_moves)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Selects middle column</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">agent_middle</span>(<span class="params">obs, config</span>):</span><br><span class="line">    <span class="keyword">return</span> config.columns//<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Selects leftmost valid column</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">agent_leftmost</span>(<span class="params">obs, config</span>):</span><br><span class="line">    valid_moves = [col <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns) <span class="keyword">if</span> obs.board[col] == <span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> valid_moves[<span class="number">0</span>]</span><br></pre></td></tr></table></figure></li>
</ul>
<p>那么，<code>obs</code>和<code>config</code>到底是什么？<code>obs</code>包含两条信息：</p>
<ul>
<li><code>obs.board</code>-游戏板（一个<code>Python</code>列表，每个网格位置有一个<code>item</code>）。</li>
<li><code>obs.mark</code>-分配给代理的标记（<code>1</code>或<code>2</code>）。</li>
</ul>
<p><code>obs.board</code>是一个显示棋子位置的<code>Python</code>列表，其中第一行首先出现，然后是第二行，依此类推。我们使用<code>1</code>来跟踪<code>1</code>的棋子，使用<code>2</code>来跟踪<code>2</code>的棋子。</p>
<img data-src="/2024/03/27/artificial-intelligence/game_ai_study/ga_1.png" class="">

<p><code>obs.board</code>将为<code>[0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 2, 1, 2, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 2, 1, 2, 0, 2, 0]</code>。</p>
<p><code>config</code>包含三部分信息：</p>
<ul>
<li><code>config.columns</code> - 游戏板中的列数（四子棋为<code>7</code>）</li>
<li><code>config.rows</code> - 游戏板的行数（四子棋为<code>6</code>）</li>
<li><code>config.inarow</code> - 玩家需要连续获得的棋子数量才能获胜（四子棋为<code>4</code>）</li>
</ul>
<p>现在花点时间研究一下我们上面定义的三个代理。</p>
<h5 id="评估代理"><a href="#评估代理" class="headerlink" title="评估代理"></a>评估代理</h5><p>为了让自定义代理玩一轮游戏，我们使用与之前相同的<code>env.run()</code>方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Agents play one game round</span></span><br><span class="line">env.run([agent_leftmost, agent_random])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show the game</span></span><br><span class="line">env.render(mode=<span class="string">&quot;ipython&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>单场比赛的结果通常不足以说明我们的智能体表现如何。为了获得更好的想法，我们将计算每个代理在多场比赛中的平均获胜百分比。为了公平起见，每个代理人都先去除一半的时间。为此，我们将使用 <code>get_win_percentages()</code>函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_win_percentages</span>(<span class="params">agent1, agent2, n_rounds=<span class="number">100</span></span>):</span><br><span class="line">    <span class="comment"># Use default Connect Four setup</span></span><br><span class="line">    config = &#123;<span class="string">&#x27;rows&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;columns&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;inarow&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line">    <span class="comment"># Agent 1 goes first (roughly) half the time          </span></span><br><span class="line">    outcomes = evaluate(<span class="string">&quot;connectx&quot;</span>, [agent1, agent2], config, [], n_rounds//<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># Agent 2 goes first (roughly) half the time      </span></span><br><span class="line">    outcomes += [[b,a] <span class="keyword">for</span> [a,b] <span class="keyword">in</span> evaluate(<span class="string">&quot;connectx&quot;</span>, [agent2, agent1], config, [], n_rounds-n_rounds//<span class="number">2</span>)]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Agent 1 Win Percentage:&quot;</span>, np.<span class="built_in">round</span>(outcomes.count([<span class="number">1</span>,-<span class="number">1</span>])/<span class="built_in">len</span>(outcomes), <span class="number">2</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Agent 2 Win Percentage:&quot;</span>, np.<span class="built_in">round</span>(outcomes.count([-<span class="number">1</span>,<span class="number">1</span>])/<span class="built_in">len</span>(outcomes), <span class="number">2</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Number of Invalid Plays by Agent 1:&quot;</span>, outcomes.count([<span class="literal">None</span>, <span class="number">0</span>]))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Number of Invalid Plays by Agent 2:&quot;</span>, outcomes.count([<span class="number">0</span>, <span class="literal">None</span>]))</span><br></pre></td></tr></table></figure>
<p>您认为哪个代理在对抗随机代理时表现更好：总是在中间的代理(<code>agent_middle</code>)，还是选择最左边有效列的代理(<code>agent_leftmost</code>)？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get_win_percentages(agent1=agent_middle, agent2=agent_random)</span><br></pre></td></tr></table></figure>
<p>看起来选择最左边有效列的代理表现最好！</p>
<h4 id="One-Step-Lookahead"><a href="#One-Step-Lookahead" class="headerlink" title="One-Step Lookahead"></a>One-Step Lookahead</h4><p>即使您是四子棋新手，您也可能已经制定了几种游戏策略。</p>
<h5 id="游戏树（Game-trees）"><a href="#游戏树（Game-trees）" class="headerlink" title="游戏树（Game trees）"></a>游戏树（Game trees）</h5><p>作为一名人类玩家，你如何看待这个游戏的玩法？您可能会做一些预测。对于每个潜在的举动，您预测对手可能会做什么反应，以及您随后将如何反应，以及对手随后可能会做什么等等。然后，您选择您认为最有可能获胜的举动。我们可以形式化这个想法，并在<strong>博弈树</strong>中表示所有可能的结果。</p>
<img data-src="/2024/03/27/artificial-intelligence/game_ai_study/ga_2.png" class="">

<p><strong>游戏树</strong>代表每个可能的动作（由代理和对手），从空棋盘开始。第一行显示代理（红色玩家）可以做出的所有可能的动作。接下来，我们记录对手（黄色玩家）可以做出的每一步反应，依此类推，直到每个分支到达游戏结束。（《四子棋》的游戏树非常大，因此我们在上图中仅显示了一个小预览。）一旦我们能够看到游戏可能结束的所有方式，它就可以帮助我们选择最有可能获胜的棋步。</p>
<h5 id="启发式（Heuristics）"><a href="#启发式（Heuristics）" class="headerlink" title="启发式（Heuristics）"></a>启发式（Heuristics）</h5><p>四子棋的完整游戏树有超过<code>4</code>万亿个不同的棋盘！因此，在实践中，我们的代理在计划移动时仅使用一小部分。为了确保不完整的树对代理仍然有用，我们将使用<strong>启发式</strong>（或<strong>启发式函数</strong>）。 启发式将分数分配给不同的游戏板，我们估计得分较高的板更有可能导致代理赢得游戏。您将根据您对游戏的了解来设计启发式。例如，对于“四子连接”来说，一种可能相当有效的启发式方法会查看一条（水平、垂直或对角线）线上的每组四个相邻位置，并分配：</p>
<ul>
<li>如果代理人连续有四个棋子（代理人获胜），则<code>1000000(1e6)</code>分。</li>
<li>如果代理人填补了三个位置，并且剩余位置为空，则得<code>1</code>分（如果代理人填补了空位，则代理人获胜）。</li>
<li>如果对手填满了三个位置，而剩下的位置是空的，则<code>-100</code>分（对手填满空位即获胜）。</li>
</ul>
<img data-src="/2024/03/27/artificial-intelligence/game_ai_study/ga_3.png" class="">

<p>代理究竟将如何使用启发式？考虑轮到代理了，它正在尝试为下图顶部所示的游戏板计划一个动作。有七种可能的移动（每列一种）。对于每一步，我们都会记录最终的游戏板。</p>
<img data-src="/2024/03/27/artificial-intelligence/game_ai_study/ga_4.png" class="">

<p>然后我们使用启发式为每个板分配分数。为此，我们搜索网格并在启发式中查找该模式的所有出现，类似于单词搜索谜题。每次出现都会修改分数。例如，</p>
<ul>
<li>第一个棋盘（智能体在第<code>0</code>列中进行游戏）得分为<code>2</code>。这是因为该棋盘包含两个不同的模式，每个模式都会为分数添加一分（两者都在上图中圈出）。</li>
<li>第二块板的得分为<code>1</code>。</li>
<li>第三块板（代理在第<code>2</code>列中进行游戏）得分为<code>0</code>。这是因为启发式中的任何模式都没有出现在板中。</li>
</ul>
<p>第一个棋盘得分最高，因此智能体将选择此棋步。这对于玩家来说也是最好的结果，因为只要再走一步，它就可以保证获胜。现在检查一下图中的内容，以确保它对您有意义！对于这个特定的例子，启发式方法非常有效，因为它匹配了得分最高的最佳动作。这只是创建<code>Connect Four</code>代理的众多启发式方法之一，您可能会发现您可以设计一种效果更好的启发式方法！一般来说，如果您不确定如何设计启发式（即如何对不同的游戏状态进行评分，或者将哪些分数分配给不同的条件），通常最好的办法就是简单地进行初步猜测，然后进行游戏, 反对你的代理人。这将使您能够识别代理做出错误动作时的特定情况，然后您可以通过修改启发式来修复这些情况。</p>
<h5 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h5><p>使用启发式为每个可能的有效动作分配分数，并且选择得分最高的动作。（如果多个动作获得高分，我们随机选择一个。）“<code>One-Step Lookahead</code>”是指智能体仅展望未来的一步，而不是深入博弈树。为了定义这个代理，我们将使用下面代码单元中的函数。当我们使用这些函数来指定代理时，它们会更有意义。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculates score if agent drops piece in selected column</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">score_move</span>(<span class="params">grid, col, mark, config</span>):</span><br><span class="line">    next_grid = drop_piece(grid, col, mark, config)</span><br><span class="line">    score = get_heuristic(next_grid, mark, config)</span><br><span class="line">    <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line"><span class="comment"># Helper function for score_move: gets board at next step if agent drops piece in selected column</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">drop_piece</span>(<span class="params">grid, col, mark, config</span>):</span><br><span class="line">    next_grid = grid.copy()</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.rows-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> next_grid[row][col] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    next_grid[row][col] = mark</span><br><span class="line">    <span class="keyword">return</span> next_grid</span><br><span class="line"></span><br><span class="line"><span class="comment"># Helper function for score_move: calculates value of heuristic for grid</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_heuristic</span>(<span class="params">grid, mark, config</span>):</span><br><span class="line">    num_threes = count_windows(grid, <span class="number">3</span>, mark, config)</span><br><span class="line">    num_fours = count_windows(grid, <span class="number">4</span>, mark, config)</span><br><span class="line">    num_threes_opp = count_windows(grid, <span class="number">3</span>, mark%<span class="number">2</span>+<span class="number">1</span>, config)</span><br><span class="line">    score = num_threes - <span class="number">1e2</span>*num_threes_opp + <span class="number">1e6</span>*num_fours</span><br><span class="line">    <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line"><span class="comment"># Helper function for get_heuristic: checks if window satisfies heuristic conditions</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_window</span>(<span class="params">window, num_discs, piece, config</span>):</span><br><span class="line">    <span class="keyword">return</span> (window.count(piece) == num_discs <span class="keyword">and</span> window.count(<span class="number">0</span>) == config.inarow-num_discs)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># Helper function for get_heuristic: counts number of windows satisfying specified heuristic conditions</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">count_windows</span>(<span class="params">grid, num_discs, piece, config</span>):</span><br><span class="line">    num_windows = <span class="number">0</span></span><br><span class="line">    <span class="comment"># horizontal</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.rows):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[row, col:col+config.inarow])</span><br><span class="line">            <span class="keyword">if</span> check_window(window, num_discs, piece, config):</span><br><span class="line">                num_windows += <span class="number">1</span></span><br><span class="line">    <span class="comment"># vertical</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.rows-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[row:row+config.inarow, col])</span><br><span class="line">            <span class="keyword">if</span> check_window(window, num_discs, piece, config):</span><br><span class="line">                num_windows += <span class="number">1</span></span><br><span class="line">    <span class="comment"># positive diagonal</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.rows-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[<span class="built_in">range</span>(row, row+config.inarow), <span class="built_in">range</span>(col, col+config.inarow)])</span><br><span class="line">            <span class="keyword">if</span> check_window(window, num_discs, piece, config):</span><br><span class="line">                num_windows += <span class="number">1</span></span><br><span class="line">    <span class="comment"># negative diagonal</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.inarow-<span class="number">1</span>, config.rows):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[<span class="built_in">range</span>(row, row-config.inarow, -<span class="number">1</span>), <span class="built_in">range</span>(col, col+config.inarow)])</span><br><span class="line">            <span class="keyword">if</span> check_window(window, num_discs, piece, config):</span><br><span class="line">                num_windows += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> num_windows</span><br><span class="line"></span><br><span class="line"><span class="comment"># The agent is always implemented as a Python function that accepts two arguments: obs and config</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">agent</span>(<span class="params">obs, config</span>):</span><br><span class="line">    <span class="comment"># Get list of valid moves</span></span><br><span class="line">    valid_moves = [c <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(config.columns) <span class="keyword">if</span> obs.board[c] == <span class="number">0</span>]</span><br><span class="line">    <span class="comment"># Convert the board to a 2D grid</span></span><br><span class="line">    grid = np.asarray(obs.board).reshape(config.rows, config.columns)</span><br><span class="line">    <span class="comment"># Use the heuristic to assign a score to each possible board in the next turn</span></span><br><span class="line">    scores = <span class="built_in">dict</span>(<span class="built_in">zip</span>(valid_moves, [score_move(grid, col, obs.mark, config) <span class="keyword">for</span> col <span class="keyword">in</span> valid_moves]))</span><br><span class="line">    <span class="comment"># Get a list of columns (moves) that maximize the heuristic</span></span><br><span class="line">    max_cols = [key <span class="keyword">for</span> key <span class="keyword">in</span> scores.keys() <span class="keyword">if</span> scores[key] == <span class="built_in">max</span>(scores.values())]</span><br><span class="line">    <span class="comment"># Select at random from the maximizing columns</span></span><br><span class="line">    <span class="keyword">return</span> random.choice(max_cols)</span><br></pre></td></tr></table></figure>
<p>在代理的代码中，我们首先获取有效移动的列表。接下来，我们将游戏板转换为<code>2D numpy</code>数组。对于四子棋来说，网格是一个<code>6</code>行<code>7</code>列的数组。然后，<code>score_move()</code>函数计算每个有效移动的启发式值。它使用几个辅助函数：<code>drop_piece()</code>返回将其棋子放入所选列时生成的网格。<code>get_heuristic()</code>计算提供的板（网格）的启发值，其中<code>mark</code>是代理的标记。此函数使用 <code>count_windows()</code>函数，该函数根据启发式计算满足特定条件的窗口（行、列或对角线中的四个相邻位置）的数量。具体来说，<code>count_windows（grid，num_discs，piece，config）</code>产生游戏板（网格）中包含带有标记棋子的玩家（代理或对手）的<code>num_discs</code>棋子的窗口数量，并且窗口中的其余位置为空 。例如，设置<code>num_discs=4</code>和<code>piece=obs.mark</code>计算代理连续获得四个棋子的次数。设置<code>num_discs=3</code>和<code>piece=obs.mark%2+1</code>则统计对手有3个棋子且剩余位置为空的窗口数量（对手将空位填满即获胜）。最后，我们得到最大化启发式的列列表，并随机选择一个。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> kaggle_environments <span class="keyword">import</span> make, evaluate</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the game environment</span></span><br><span class="line">env = make(<span class="string">&quot;connectx&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Two random agents play one game round</span></span><br><span class="line">env.run([agent, <span class="string">&quot;random&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show the game</span></span><br><span class="line">env.render(mode=<span class="string">&quot;ipython&quot;</span>)</span><br></pre></td></tr></table></figure>
<img data-src="/2024/03/27/artificial-intelligence/game_ai_study/ga_5.png" class="">

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_win_percentages</span>(<span class="params">agent1, agent2, n_rounds=<span class="number">100</span></span>):</span><br><span class="line">    <span class="comment"># Use default Connect Four setup</span></span><br><span class="line">    config = &#123;<span class="string">&#x27;rows&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;columns&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;inarow&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line">    <span class="comment"># Agent 1 goes first (roughly) half the time          </span></span><br><span class="line">    outcomes = evaluate(<span class="string">&quot;connectx&quot;</span>, [agent1, agent2], config, [], n_rounds//<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># Agent 2 goes first (roughly) half the time      </span></span><br><span class="line">    outcomes += [[b,a] <span class="keyword">for</span> [a,b] <span class="keyword">in</span> evaluate(<span class="string">&quot;connectx&quot;</span>, [agent2, agent1], config, [], n_rounds-n_rounds//<span class="number">2</span>)]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Agent 1 Win Percentage:&quot;</span>, np.<span class="built_in">round</span>(outcomes.count([<span class="number">1</span>,-<span class="number">1</span>])/<span class="built_in">len</span>(outcomes), <span class="number">2</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Agent 2 Win Percentage:&quot;</span>, np.<span class="built_in">round</span>(outcomes.count([-<span class="number">1</span>,<span class="number">1</span>])/<span class="built_in">len</span>(outcomes), <span class="number">2</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Number of Invalid Plays by Agent 1:&quot;</span>, outcomes.count([<span class="literal">None</span>, <span class="number">0</span>]))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Number of Invalid Plays by Agent 2:&quot;</span>, outcomes.count([<span class="number">0</span>, <span class="literal">None</span>]))</span><br><span class="line"></span><br><span class="line">get_win_percentages(agent1=agent, agent2=<span class="string">&quot;random&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>结果输出为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Agent 1 Win Percentage: 1.0</span><br><span class="line">Agent 2 Win Percentage: 0.0</span><br><span class="line">Number of Invalid Plays by Agent 1: 0</span><br><span class="line">Number of Invalid Plays by Agent 2: 0</span><br></pre></td></tr></table></figure>
<p>该代理的性能比随机代理好得多！</p>
<h4 id="N-Step-Lookahead"><a href="#N-Step-Lookahead" class="headerlink" title="N-Step Lookahead"></a>N-Step Lookahead</h4><h5 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h5><p>您学习了如何构建<code>One-Step Lookahead</code>的代理。该代理表现相当不错，但绝对还有改进的空间！例如，考虑下图中的潜在走势。（请注意，我们对列使用从零开始的编号，因此最左边的列对应于 <code>col=0</code>，下一列对应于<code>col=1</code>，依此类推。）</p>
<img data-src="/2024/03/27/artificial-intelligence/game_ai_study/ga_6.png" class="">

<p>通过<code>One-Step Lookahead</code>，红色玩家选择第<code>5</code>列或第<code>6</code>列之一，每一列都有<code>50%</code>的概率。但是，第<code>5</code>列显然是一个糟糕的棋步，因为它让对手只需要多一个回合就能赢得比赛。不幸的是，智能体不知道这一点，因为它只能展望未来的一步。接下来，您将使用<strong>极小极大算法</strong>来帮助代理更长远地展望未来并做出更明智的决策。</p>
<h5 id="Minimax算法"><a href="#Minimax算法" class="headerlink" title="Minimax算法"></a>Minimax算法</h5><p>我们希望利用<strong>游戏树</strong>更深处的信息。现在，假设我们的深度为<code>3</code>。这样，在决定其移动时，代理会考虑所有可能的游戏板，这些游戏板可以由</p>
<ul>
<li>代理人的移动。</li>
<li>对手的动作。</li>
<li>代理人的下一步行动。</li>
</ul>
<p>我们将使用一个视觉示例。为简单起见，我们假设在每一回合，代理和对手都只有两种可能的动作。下图中的每个蓝色矩形对应着不同的游戏板。</p>
<img data-src="/2024/03/27/artificial-intelligence/game_ai_study/ga_7.png" class="">

<p>我们用启发式的分数标记了树底部的每个“叶节点”。和以前一样，当前的游戏板位于图的顶部，代理的目标是结束获得尽可能高的分数。但请注意，智能体不再完全控制其分数——在智能体采取行动后，对手选择自己的行动。而且，对手的选择对于玩家来说可能是灾难性的！尤其，</p>
<ul>
<li>如果智能体选择左边的分支，对手可以强制得分为<code>-1</code>。</li>
<li>如果智能体选择了正确的分支，对手可以强制得分<code>+10</code>。</li>
</ul>
<p>现在花点时间检查一下图中的这一点，以确保它对您有意义！考虑到这一点，您可能会认为正确的分支对于代理来说是更好的选择，因为它是风险较小的选择。当然，它放弃了获得只能在左侧分支上访问的大分数（<code>+40</code>）的可能性，但它也保证了代理至少获得<code>+10</code>分。这是<strong>极小极大算法</strong>背后的主要思想：<strong>智能体选择移动以获得尽可能高的分数，并且假设对手将通过选择移动来迫使分数尽可能低来抵消这一点</strong>。也就是说，智能体和对手有相反的目标，我们假设对手发挥最佳。那么，在实践中，智能体如何利用这个假设来选择行动呢？我们在下图中说明了智能体的思维过程。</p>
<img data-src="/2024/03/27/artificial-intelligence/game_ai_study/ga_8.png" class="">

<p>在该示例中，<code>minimax</code>为左侧的移动分配<code>-1</code>分，为右侧的移动分配<code>+10</code>分。因此，智能体将选择右侧的移动。</p>
<h5 id="Code-1"><a href="#Code-1" class="headerlink" title="Code"></a>Code</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># Gets board at next step if agent drops piece in selected column</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">drop_piece</span>(<span class="params">grid, col, mark, config</span>):</span><br><span class="line">    next_grid = grid.copy()</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.rows-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> next_grid[row][col] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    next_grid[row][col] = mark</span><br><span class="line">    <span class="keyword">return</span> next_grid</span><br><span class="line"></span><br><span class="line"><span class="comment"># Helper function for get_heuristic: checks if window satisfies heuristic conditions</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_window</span>(<span class="params">window, num_discs, piece, config</span>):</span><br><span class="line">    <span class="keyword">return</span> (window.count(piece) == num_discs <span class="keyword">and</span> window.count(<span class="number">0</span>) == config.inarow-num_discs)</span><br><span class="line">    </span><br><span class="line"><span class="comment"># Helper function for get_heuristic: counts number of windows satisfying specified heuristic conditions</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">count_windows</span>(<span class="params">grid, num_discs, piece, config</span>):</span><br><span class="line">    num_windows = <span class="number">0</span></span><br><span class="line">    <span class="comment"># horizontal</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.rows):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[row, col:col+config.inarow])</span><br><span class="line">            <span class="keyword">if</span> check_window(window, num_discs, piece, config):</span><br><span class="line">                num_windows += <span class="number">1</span></span><br><span class="line">    <span class="comment"># vertical</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.rows-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[row:row+config.inarow, col])</span><br><span class="line">            <span class="keyword">if</span> check_window(window, num_discs, piece, config):</span><br><span class="line">                num_windows += <span class="number">1</span></span><br><span class="line">    <span class="comment"># positive diagonal</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.rows-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[<span class="built_in">range</span>(row, row+config.inarow), <span class="built_in">range</span>(col, col+config.inarow)])</span><br><span class="line">            <span class="keyword">if</span> check_window(window, num_discs, piece, config):</span><br><span class="line">                num_windows += <span class="number">1</span></span><br><span class="line">    <span class="comment"># negative diagonal</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.inarow-<span class="number">1</span>, config.rows):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[<span class="built_in">range</span>(row, row-config.inarow, -<span class="number">1</span>), <span class="built_in">range</span>(col, col+config.inarow)])</span><br><span class="line">            <span class="keyword">if</span> check_window(window, num_discs, piece, config):</span><br><span class="line">                num_windows += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> num_windows</span><br></pre></td></tr></table></figure>
<p>我们还需要稍微修改一下<strong>启发式</strong>，因为对手现在能够修改游戏板。</p>
<img data-src="/2024/03/27/artificial-intelligence/game_ai_study/ga_9.png" class="">

<p>我们需要通过下棋来检查对手是否赢得了比赛。新的启发式方法查看（水平、垂直或对角线）线上的每组四个相邻位置并分配：</p>
<ul>
<li>如果代理人连续有四张棋子（代理人获胜），则<code>1000000</code>(<code>1e6</code>) 分。</li>
<li>如果代理人填补了三个位置，并且剩余位置为空，则得<code>1</code>分（如果代理人填补了空位，则代理人获胜）。</li>
<li>如果对手填满了三个位置，而剩余位置为空（对手填满空位则获胜），则<code>-100</code>分。</li>
<li>如果对手连续有四张棋子（对手获胜），则<code>-10000</code>(<code>-1e4</code>) 分。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Helper function for minimax: calculates value of heuristic for grid</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_heuristic</span>(<span class="params">grid, mark, config</span>):</span><br><span class="line">    num_threes = count_windows(grid, <span class="number">3</span>, mark, config)</span><br><span class="line">    num_fours = count_windows(grid, <span class="number">4</span>, mark, config)</span><br><span class="line">    num_threes_opp = count_windows(grid, <span class="number">3</span>, mark%<span class="number">2</span>+<span class="number">1</span>, config)</span><br><span class="line">    num_fours_opp = count_windows(grid, <span class="number">4</span>, mark%<span class="number">2</span>+<span class="number">1</span>, config)</span><br><span class="line">    score = num_threes - <span class="number">1e2</span>*num_threes_opp - <span class="number">1e4</span>*num_fours_opp + <span class="number">1e6</span>*num_fours</span><br><span class="line">    <span class="keyword">return</span> score</span><br></pre></td></tr></table></figure>
<p>我们定义了<strong>极小极大代理</strong>所需的一些附加函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Uses minimax to calculate value of dropping piece in selected column</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">score_move</span>(<span class="params">grid, col, mark, config, nsteps</span>):</span><br><span class="line">    next_grid = drop_piece(grid, col, mark, config)</span><br><span class="line">    score = minimax(next_grid, nsteps-<span class="number">1</span>, <span class="literal">False</span>, mark, config)</span><br><span class="line">    <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line"><span class="comment"># Helper function for minimax: checks if agent or opponent has four in a row in the window</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_terminal_window</span>(<span class="params">window, config</span>):</span><br><span class="line">    <span class="keyword">return</span> window.count(<span class="number">1</span>) == config.inarow <span class="keyword">or</span> window.count(<span class="number">2</span>) == config.inarow</span><br><span class="line"></span><br><span class="line"><span class="comment"># Helper function for minimax: checks if game has ended</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_terminal_node</span>(<span class="params">grid, config</span>):</span><br><span class="line">    <span class="comment"># Check for draw </span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">list</span>(grid[<span class="number">0</span>, :]).count(<span class="number">0</span>) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="comment"># Check for win: horizontal, vertical, or diagonal</span></span><br><span class="line">    <span class="comment"># horizontal </span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.rows):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[row, col:col+config.inarow])</span><br><span class="line">            <span class="keyword">if</span> is_terminal_window(window, config):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="comment"># vertical</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.rows-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[row:row+config.inarow, col])</span><br><span class="line">            <span class="keyword">if</span> is_terminal_window(window, config):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="comment"># positive diagonal</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.rows-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[<span class="built_in">range</span>(row, row+config.inarow), <span class="built_in">range</span>(col, col+config.inarow)])</span><br><span class="line">            <span class="keyword">if</span> is_terminal_window(window, config):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="comment"># negative diagonal</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(config.inarow-<span class="number">1</span>, config.rows):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns-(config.inarow-<span class="number">1</span>)):</span><br><span class="line">            window = <span class="built_in">list</span>(grid[<span class="built_in">range</span>(row, row-config.inarow, -<span class="number">1</span>), <span class="built_in">range</span>(col, col+config.inarow)])</span><br><span class="line">            <span class="keyword">if</span> is_terminal_window(window, config):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Minimax implementation</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">minimax</span>(<span class="params">node, depth, maximizingPlayer, mark, config</span>):</span><br><span class="line">    is_terminal = is_terminal_node(node, config)</span><br><span class="line">    valid_moves = [c <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(config.columns) <span class="keyword">if</span> node[<span class="number">0</span>][c] == <span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> depth == <span class="number">0</span> <span class="keyword">or</span> is_terminal:</span><br><span class="line">        <span class="keyword">return</span> get_heuristic(node, mark, config)</span><br><span class="line">    <span class="keyword">if</span> maximizingPlayer:</span><br><span class="line">        value = -np.Inf</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> valid_moves:</span><br><span class="line">            child = drop_piece(node, col, mark, config)</span><br><span class="line">            value = <span class="built_in">max</span>(value, minimax(child, depth-<span class="number">1</span>, <span class="literal">False</span>, mark, config))</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        value = np.Inf</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> valid_moves:</span><br><span class="line">            child = drop_piece(node, col, mark%<span class="number">2</span>+<span class="number">1</span>, config)</span><br><span class="line">            value = <span class="built_in">min</span>(value, minimax(child, depth-<span class="number">1</span>, <span class="literal">True</span>, mark, config))</span><br><span class="line">        <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure>
<p><code>N_STEPS</code>变量用于设置树的深度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># How deep to make the game tree: higher values take longer to run!</span></span><br><span class="line">N_STEPS = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">agent</span>(<span class="params">obs, config</span>):</span><br><span class="line">    <span class="comment"># Get list of valid moves</span></span><br><span class="line">    valid_moves = [c <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(config.columns) <span class="keyword">if</span> obs.board[c] == <span class="number">0</span>]</span><br><span class="line">    <span class="comment"># Convert the board to a 2D grid</span></span><br><span class="line">    grid = np.asarray(obs.board).reshape(config.rows, config.columns)</span><br><span class="line">    <span class="comment"># Use the heuristic to assign a score to each possible board in the next step</span></span><br><span class="line">    scores = <span class="built_in">dict</span>(<span class="built_in">zip</span>(valid_moves, [score_move(grid, col, obs.mark, config, N_STEPS) <span class="keyword">for</span> col <span class="keyword">in</span> valid_moves]))</span><br><span class="line">    <span class="comment"># Get a list of columns (moves) that maximize the heuristic</span></span><br><span class="line">    max_cols = [key <span class="keyword">for</span> key <span class="keyword">in</span> scores.keys() <span class="keyword">if</span> scores[key] == <span class="built_in">max</span>(scores.values())]</span><br><span class="line">    <span class="comment"># Select at random from the maximizing columns</span></span><br><span class="line">    <span class="keyword">return</span> random.choice(max_cols)</span><br></pre></td></tr></table></figure>
<p>我们看到与随机代理的一轮游戏的结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> kaggle_environments <span class="keyword">import</span> make, evaluate</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the game environment</span></span><br><span class="line">env = make(<span class="string">&quot;connectx&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Two random agents play one game round</span></span><br><span class="line">env.run([agent, <span class="string">&quot;random&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show the game</span></span><br><span class="line">env.render(mode=<span class="string">&quot;ipython&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>我们会检查它的平均表现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_win_percentages</span>(<span class="params">agent1, agent2, n_rounds=<span class="number">100</span></span>):</span><br><span class="line">    <span class="comment"># Use default Connect Four setup</span></span><br><span class="line">    config = &#123;<span class="string">&#x27;rows&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;columns&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;inarow&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line">    <span class="comment"># Agent 1 goes first (roughly) half the time          </span></span><br><span class="line">    outcomes = evaluate(<span class="string">&quot;connectx&quot;</span>, [agent1, agent2], config, [], n_rounds//<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># Agent 2 goes first (roughly) half the time      </span></span><br><span class="line">    outcomes += [[b,a] <span class="keyword">for</span> [a,b] <span class="keyword">in</span> evaluate(<span class="string">&quot;connectx&quot;</span>, [agent2, agent1], config, [], n_rounds-n_rounds//<span class="number">2</span>)]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Agent 1 Win Percentage:&quot;</span>, np.<span class="built_in">round</span>(outcomes.count([<span class="number">1</span>,-<span class="number">1</span>])/<span class="built_in">len</span>(outcomes), <span class="number">2</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Agent 2 Win Percentage:&quot;</span>, np.<span class="built_in">round</span>(outcomes.count([-<span class="number">1</span>,<span class="number">1</span>])/<span class="built_in">len</span>(outcomes), <span class="number">2</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Number of Invalid Plays by Agent 1:&quot;</span>, outcomes.count([<span class="literal">None</span>, <span class="number">0</span>]))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Number of Invalid Plays by Agent 2:&quot;</span>, outcomes.count([<span class="number">0</span>, <span class="literal">None</span>]))</span><br><span class="line"></span><br><span class="line">get_win_percentages(agent1=agent, agent2=<span class="string">&quot;random&quot;</span>, n_rounds=<span class="number">50</span>)</span><br></pre></td></tr></table></figure>
<p>结果输出为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Agent 1 Win Percentage: 1.0</span><br><span class="line">Agent 2 Win Percentage: 0.0</span><br><span class="line">Number of Invalid Plays by Agent 1: 0</span><br><span class="line">Number of Invalid Plays by Agent 2: 0</span><br></pre></td></tr></table></figure>
<h4 id="深度强化学习（Deep-Reinforcement-Learning）"><a href="#深度强化学习（Deep-Reinforcement-Learning）" class="headerlink" title="深度强化学习（Deep Reinforcement Learning）"></a>深度强化学习（Deep Reinforcement Learning）</h4><h5 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h5><p>到目前为止，我们的玩家依赖于有关如何玩游戏的详细信息。<strong>启发式</strong>确实提供了很多关于如何选择动作的指导！接下来，您将学习如何使用<strong>强化学习</strong>来构建<strong>智能代理</strong>，而无需使用启发式方法。相反，我们将随着时间的推移逐渐完善代理的策略，只需玩游戏并尝试最大化获胜率。</p>
<h5 id="神经网络"><a href="#神经网络" class="headerlink" title="神经网络"></a>神经网络</h5><p>很难想出一个完美的<strong>启发式</strong>。改进启发式通常需要多次玩游戏，以确定代理可以做出更好选择的特定情况。而且，要解释到底出了什么问题，并最终纠正旧错误而不意外引入新错误，可能具有挑战性。如果我们有更系统的方法来提升智能体的游戏体验，不是会容易很多吗？为了实现这一目标，我们将用<strong>神经网络代替启发式方法</strong>。网络接受当前板作为输入。并且，它输出每个可能的移动的概率。</p>
<img data-src="/2024/03/27/artificial-intelligence/game_ai_study/ga_10.png" class="">

<p>然后，代理通过从这些概率中采样来选择移动。例如，对于上图中的游戏板，智能体以<code>50%</code>的概率选择第<code>4</code>列。这样，为了编码一个好的游戏策略，我们只需要修改<strong>网络的权重</strong>，以便对于每个可能的游戏板，为更好的动作分配更高的概率。至少在理论上，这是我们的目标。在实践中，我们实际上不会检查，四子棋有超过<code>4</code>万亿个可能的游戏板！</p>
<h5 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h5><p>在实践中，我们如何完成修改网络权重的任务？</p>
<ul>
<li>每次移动后，我们都会给智能体一个奖励，告诉它做得有多好：<ul>
<li>如果智能体在该举动中赢得了游戏，我们将给予它<code>+1</code>的奖励。</li>
<li>否则，如果智能体采取了无效的行动（结束了游戏），我们将给予它<code>-10</code>的奖励。</li>
<li>否则，如果对手在下一步行动中赢得了比赛（即代理未能阻止对手获胜），我们将给予代理奖励<code>-1</code>。</li>
<li>否则，代理将获得<code>1/42</code>的奖励。</li>
</ul>
</li>
<li>每场比赛结束时，智能体都会将其奖励相加。我们将奖励的总和称为代理的累积奖励。<ul>
<li>例如，如果游戏持续<code>8</code>步（每个玩家玩四次），并且智能体最终获胜，则其累积奖励为<code>3*(1/42) + 1</code>。</li>
<li>如果游戏持续<code>11</code>步（对手先走，因此智能体下棋五次），并且对手在最后一步获胜，则智能体的累积奖励为<code>4*(1/42) - 1</code>。</li>
<li>如果游戏以平局结束，则智能体正好下完 21 步，并获得<code>21*(1/42)</code> 的累积奖励。</li>
<li>如果游戏持续<code>7</code>步并以智能体选择无效的移动而结束，则智能体获得的累积奖励为<code>3*(1/42) - 10</code>。</li>
</ul>
</li>
</ul>
<p>我们的目标是找到（平均）最大化代理累积奖励的<strong>神经网络权重</strong>。这种使用<strong>奖励</strong>来跟踪代理表现的想法是强化学习领域的核心思想。一旦我们以这种方式定义问题，我们就可以使用各种<strong>强化学习算法</strong>中的任何一种来生成代理。</p>
<h5 id="强化学习（Reinforcement-Learning）"><a href="#强化学习（Reinforcement-Learning）" class="headerlink" title="强化学习（Reinforcement Learning）"></a>强化学习（Reinforcement Learning）</h5><p>强化学习算法有很多种，例如<code>DQN、A2C</code>和<code>PPO</code>等。所有这些算法都使用类似的过程来生成代理：</p>
<ul>
<li>最初，权重设置为随机值。</li>
<li>当代理玩游戏时，算法会不断尝试新的权重值，以了解平均累积奖励受到的影响。随着时间的推移，在玩了很多游戏之后，我们很好地了解了权重如何影响<strong>累积奖励</strong>，并且算法会选择表现更好的权重。当然，我们在这里掩盖了细节，这个过程涉及很多复杂性。 现在，我们关注大局！</li>
<li>这样，我们最终会得到一个试图赢得游戏的代理（因此它获得<code>+1</code>的最终奖励，并避免<code>-1</code>和<code>-10</code>）并尝试使游戏持续尽可能长的时间（因此 它会尽可能多地收集<code>1/42</code>奖金）。您可能会争辩说，希望游戏持续尽可能长的时间并没有真正意义<code>-</code>这可能会导致代理效率非常低，在游戏早期不会采取明显的获胜动作。而且，你的直觉是正确的——这将使智能体需要更长的时间才能下出获胜的棋步！我们加入<code>1/42</code>奖励的原因是为了帮助我们将使用的算法更好地收敛。</li>
</ul>
<h5 id="Code-2"><a href="#Code-2" class="headerlink" title="Code"></a>Code</h5><p>网上有很多强化学习算法的优秀实现。为了使环境与稳定基线兼容，我们需要做一些额外的工作。为此，我们定义了下面的<code>ConnectFourGym</code>类。此类将<code>ConnectX</code>实现为<code>OpenAI Gym</code>环境并使用多种方法：</p>
<ul>
<li><code>Reset()</code>将在每个游戏开始时被调用。它以<code>6</code>行<code>7</code>列的<code>2D numpy</code>数组形式返回起始游戏板。</li>
<li><code>change_reward()</code>自定义代理收到的奖励。（比赛已经有自己的奖励系统，用于对代理进行排名，并且此方法会更改值以匹配我们设计的奖励系统。）</li>
<li><code>step()</code>用于播放代理的动作选择（作为动作提供）以及对手的响应。<ul>
<li>生成的游戏板（作为<code>numpy</code>数组）。</li>
<li>代理的奖励（仅来自最近的移动：<code>+1、-10、-1</code>或<code>1/42</code>之一）。</li>
<li>游戏是否结束（如果游戏结束，<code>done=True</code>否则，<code>done=False</code>）。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"><span class="keyword">from</span> kaggle_environments <span class="keyword">import</span> make, evaluate</span><br><span class="line"><span class="keyword">from</span> gym <span class="keyword">import</span> spaces</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConnectFourGym</span>(gym.Env):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, agent2=<span class="string">&quot;random&quot;</span></span>):</span><br><span class="line">        ks_env = make(<span class="string">&quot;connectx&quot;</span>, debug=<span class="literal">True</span>)</span><br><span class="line">        self.env = ks_env.train([<span class="literal">None</span>, agent2])</span><br><span class="line">        self.rows = ks_env.configuration.rows</span><br><span class="line">        self.columns = ks_env.configuration.columns</span><br><span class="line">        <span class="comment"># Learn about spaces here: http://gym.openai.com/docs/#spaces</span></span><br><span class="line">        self.action_space = spaces.Discrete(self.columns)</span><br><span class="line">        self.observation_space = spaces.Box(low=<span class="number">0</span>, high=<span class="number">2</span>, </span><br><span class="line">                                            shape=(<span class="number">1</span>,self.rows,self.columns), dtype=<span class="built_in">int</span>)</span><br><span class="line">        <span class="comment"># Tuple corresponding to the min and max possible rewards</span></span><br><span class="line">        self.reward_range = (-<span class="number">10</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># StableBaselines throws error if these are not defined</span></span><br><span class="line">        self.spec = <span class="literal">None</span></span><br><span class="line">        self.metadata = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset</span>(<span class="params">self</span>):</span><br><span class="line">        self.obs = self.env.reset()</span><br><span class="line">        <span class="keyword">return</span> np.array(self.obs[<span class="string">&#x27;board&#x27;</span>]).reshape(<span class="number">1</span>,self.rows,self.columns)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">change_reward</span>(<span class="params">self, old_reward, done</span>):</span><br><span class="line">        <span class="keyword">if</span> old_reward == <span class="number">1</span>: <span class="comment"># The agent won the game</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> done: <span class="comment"># The opponent won the game</span></span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># Reward 1/42</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>/(self.rows*self.columns)</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">step</span>(<span class="params">self, action</span>):</span><br><span class="line">        <span class="comment"># Check if agent&#x27;s move is valid</span></span><br><span class="line">        is_valid = (self.obs[<span class="string">&#x27;board&#x27;</span>][<span class="built_in">int</span>(action)] == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> is_valid: <span class="comment"># Play the move</span></span><br><span class="line">            self.obs, old_reward, done, _ = self.env.step(<span class="built_in">int</span>(action))</span><br><span class="line">            reward = self.change_reward(old_reward, done)</span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># End the game and penalize agent</span></span><br><span class="line">            reward, done, _ = -<span class="number">10</span>, <span class="literal">True</span>, &#123;&#125;</span><br><span class="line">        <span class="keyword">return</span> np.array(self.obs[<span class="string">&#x27;board&#x27;</span>]).reshape(<span class="number">1</span>,self.rows,self.columns), reward, done, _</span><br></pre></td></tr></table></figure>
<p>我们将训练一个代理来击败随机代理。我们在下面的<code>agent2</code>参数中指定这个对手。下一步是<strong>指定神经网络的架构</strong>。在本例中，我们使用<strong>卷积神经网络</strong>。</p>
<div class="note warning"><p>请注意，这是输出选择每一列的概率的神经网络。由于我们使用<code>PPO</code>算法，我们的网络还将输出一些附加信息（称为输入的“值”）。</p>
</div>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch <span class="keyword">as</span> th</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">from</span> stable_baselines3 <span class="keyword">import</span> PPO </span><br><span class="line"><span class="keyword">from</span> stable_baselines3.common.torch_layers <span class="keyword">import</span> BaseFeaturesExtractor</span><br><span class="line"></span><br><span class="line"><span class="comment"># Neural network for predicting action values</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomCNN</span>(<span class="title class_ inherited__">BaseFeaturesExtractor</span>):</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, observation_space: gym.spaces.Box, features_dim: <span class="built_in">int</span>=<span class="number">128</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(CustomCNN, self).__init__(observation_space, features_dim)</span><br><span class="line">        <span class="comment"># CxHxW images (channels first)</span></span><br><span class="line">        n_input_channels = observation_space.shape[<span class="number">0</span>]</span><br><span class="line">        self.cnn = nn.Sequential(</span><br><span class="line">            nn.Conv2d(n_input_channels, <span class="number">32</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">0</span>),</span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.Conv2d(<span class="number">32</span>, <span class="number">64</span>, kernel_size=<span class="number">3</span>, stride=<span class="number">1</span>, padding=<span class="number">0</span>),</span><br><span class="line">            nn.ReLU(),</span><br><span class="line">            nn.Flatten(),</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Compute shape by doing one forward pass</span></span><br><span class="line">        <span class="keyword">with</span> th.no_grad():</span><br><span class="line">            n_flatten = self.cnn(</span><br><span class="line">                th.as_tensor(observation_space.sample()[<span class="literal">None</span>]).<span class="built_in">float</span>()</span><br><span class="line">            ).shape[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        self.linear = nn.Sequential(nn.Linear(n_flatten, features_dim), nn.ReLU())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, observations: th.Tensor</span>) -&gt; th.Tensor:</span><br><span class="line">        <span class="keyword">return</span> self.linear(self.cnn(observations))</span><br><span class="line"></span><br><span class="line">policy_kwargs = <span class="built_in">dict</span>(</span><br><span class="line">    features_extractor_class=CustomCNN,</span><br><span class="line">)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># Initialize agent</span></span><br><span class="line">model = PPO(<span class="string">&quot;CnnPolicy&quot;</span>, env, policy_kwargs=policy_kwargs, verbose=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>在上面的代码单元中，神经网络的权重最初设置为随机值。在下一个代码单元中，我们“<strong>训练代理</strong>”，这只是我们找到可能导致代理选择良好动作的神经网络权重的另一种方式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Train agent</span></span><br><span class="line">model.learn(total_timesteps=<span class="number">60000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">agent1</span>(<span class="params">obs, config</span>):</span><br><span class="line">    <span class="comment"># Use the best model to select a column</span></span><br><span class="line">    col, _ = model.predict(np.array(obs[<span class="string">&#x27;board&#x27;</span>]).reshape(<span class="number">1</span>, <span class="number">6</span>,<span class="number">7</span>))</span><br><span class="line">    <span class="comment"># Check if selected column is valid</span></span><br><span class="line">    is_valid = (obs[<span class="string">&#x27;board&#x27;</span>][<span class="built_in">int</span>(col)] == <span class="number">0</span>)</span><br><span class="line">    <span class="comment"># If not valid, select random move. </span></span><br><span class="line">    <span class="keyword">if</span> is_valid:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(col)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> random.choice([col <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(config.columns) <span class="keyword">if</span> obs.board[<span class="built_in">int</span>(col)] == <span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<p>在下一个代码单元中，我们看到与随机代理的一轮游戏的结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create the game environment</span></span><br><span class="line">env = make(<span class="string">&quot;connectx&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Two random agents play one game round</span></span><br><span class="line">env.run([agent1, <span class="string">&quot;random&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># Show the game</span></span><br><span class="line">env.render(mode=<span class="string">&quot;ipython&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>并且，我们计算它相对于随机代理的平均表现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_win_percentages</span>(<span class="params">agent1, agent2, n_rounds=<span class="number">100</span></span>):</span><br><span class="line">    <span class="comment"># Use default Connect Four setup</span></span><br><span class="line">    config = &#123;<span class="string">&#x27;rows&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;columns&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;inarow&#x27;</span>: <span class="number">4</span>&#125;</span><br><span class="line">    <span class="comment"># Agent 1 goes first (roughly) half the time          </span></span><br><span class="line">    outcomes = evaluate(<span class="string">&quot;connectx&quot;</span>, [agent1, agent2], config, [], n_rounds//<span class="number">2</span>)</span><br><span class="line">    <span class="comment"># Agent 2 goes first (roughly) half the time      </span></span><br><span class="line">    outcomes += [[b,a] <span class="keyword">for</span> [a,b] <span class="keyword">in</span> evaluate(<span class="string">&quot;connectx&quot;</span>, [agent2, agent1], config, [], n_rounds-n_rounds//<span class="number">2</span>)]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Agent 1 Win Percentage:&quot;</span>, np.<span class="built_in">round</span>(outcomes.count([<span class="number">1</span>,-<span class="number">1</span>])/<span class="built_in">len</span>(outcomes), <span class="number">2</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Agent 2 Win Percentage:&quot;</span>, np.<span class="built_in">round</span>(outcomes.count([-<span class="number">1</span>,<span class="number">1</span>])/<span class="built_in">len</span>(outcomes), <span class="number">2</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Number of Invalid Plays by Agent 1:&quot;</span>, outcomes.count([<span class="literal">None</span>, <span class="number">0</span>]))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Number of Invalid Plays by Agent 2:&quot;</span>, outcomes.count([<span class="number">0</span>, <span class="literal">None</span>]))</span><br><span class="line"></span><br><span class="line">get_win_percentages(agent1=agent1, agent2=<span class="string">&quot;random&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>结果输出为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Agent <span class="number">1</span> Win Percentage: <span class="number">0.68</span></span><br><span class="line">Agent <span class="number">2</span> Win Percentage: <span class="number">0.32</span></span><br><span class="line">Number of Invalid Plays by Agent <span class="number">1</span>: <span class="number">0</span></span><br><span class="line">Number of Invalid Plays by Agent <span class="number">2</span>: <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是，我们在这里创建的代理只是经过训练来击败随机代理，因为它的所有游戏体验都是以随机代理为对手。如果我们想要产生一个比许多其他智能体可靠地表现更好的智能体，我们必须在训练期间将我们的智能体暴露给这些其他智能体。</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>umbrella
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/" title="游戏AI &amp; 强化学习">https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/AI/" rel="tag"># AI</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/03/26/artificial-intelligence/data_cleaning_study/" rel="prev" title="数据清理（Pandas）">
                  <i class="fa fa-chevron-left"></i> 数据清理（Pandas）
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/03/27/artificial-intelligence/jax_tensorflow_study/" rel="next" title="TensorFlow & JAX">
                  TensorFlow & JAX <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">辽ICP备15012817号-2 </a>
  </div>
  <div class="copyright">
    &copy; 2022 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">umbrella</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">1.2m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">67:49</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/fresh88888888" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/comments.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/motion.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/next-boot.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/pjax.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/third-party/search/local-search.min.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.12/pdfobject.min.js","integrity":"sha256-g2xji1rlE3KsGVClvuxTbcR0Kn2+wtQADSff2Tbb4zA="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/third-party/tags/pdf.min.js"></script>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/third-party/fancybox.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/third-party/pace.min.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":5000,"priority":true,"url":"https://fresh88888888.github.io/2024/03/27/artificial-intelligence/game_ai_study/"}</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/third-party/quicklink.min.js"></script>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"fresh88888888.github.io","issue_term":"title","theme":"github-light"}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-next/8.17.1/third-party/comments/utterances.min.js"></script>

</body>
</html>
